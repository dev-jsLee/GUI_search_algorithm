#!/bin/bash

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}=========================================="
echo -e " Algorithm Visualizer ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸"
echo -e " Linux/macOS ë²„ì „"
echo -e "==========================================${NC}"
echo

# ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ (Python ì²´í¬ëŠ” ì˜ˆì™¸)
# set -eëŠ” ë‚˜ì¤‘ì— ì„¤ì •

# ì—ëŸ¬ í•¸ë“¤ë§ í•¨ìˆ˜
handle_error() {
    echo -e "${RED}âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: $1${NC}"
    exit 1
}

# Python ì„¤ì¹˜ ê°€ì´ë“œ í•¨ìˆ˜
show_python_install_guide() {
    echo -e "${RED}âŒ Pythonì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!${NC}"
    echo
    echo -e "${BLUE}ğŸ“‹ Python ì„¤ì¹˜ ë°©ë²•:${NC}"
    
    if [[ "$OSTYPE" == "darwin"* ]]; then
        # macOS
        echo -e "${YELLOW}macOS ì‚¬ìš©ì:${NC}"
        echo "  1. Homebrew ì‚¬ìš©: brew install python"
        echo "  2. ê³µì‹ ì‚¬ì´íŠ¸: https://www.python.org/downloads/"
        echo "  3. pyenv ì‚¬ìš©: brew install pyenv && pyenv install 3.11"
    else
        # Linux
        echo -e "${YELLOW}Linux ì‚¬ìš©ì:${NC}"
        echo "  Ubuntu/Debian: sudo apt update && sudo apt install python3 python3-pip"
        echo "  CentOS/RHEL: sudo yum install python3 python3-pip"
        echo "  Fedora: sudo dnf install python3 python3-pip"
        echo "  Arch: sudo pacman -S python python-pip"
    fi
    
    echo
    echo -e "${BLUE}ì„¤ì¹˜ ì™„ë£Œ í›„ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.${NC}"
    exit 1
}

echo -e "${YELLOW}[0/6] Python ì„¤ì¹˜ í™•ì¸ ì¤‘...${NC}"
if command -v python3 &> /dev/null; then
    echo -e "${GREEN}âœ… Python3ì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.${NC}"
    python3 --version
elif command -v python &> /dev/null; then
    echo -e "${GREEN}âœ… Pythonì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.${NC}"
    python --version
else
    show_python_install_guide
fi

# ì´ì œë¶€í„° ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ
set -e

echo
echo -e "${YELLOW}[1/6] uv ì„¤ì¹˜ í™•ì¸ ì¤‘...${NC}"
if command -v uv &> /dev/null; then
    echo -e "${GREEN}âœ… uvê°€ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.${NC}"
else
    echo "uvê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì¹˜ ì¤‘..."
    
    # ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ uv ì„¤ì¹˜ ì‹œë„
    install_success=false
    
    # ë°©ë²• 1: pip ì‚¬ìš©
    if command -v pip3 &> /dev/null; then
        echo "pip3ë¥¼ ì‚¬ìš©í•˜ì—¬ uv ì„¤ì¹˜ ì‹œë„ ì¤‘..."
        if pip3 install uv 2>/dev/null; then
            install_success=true
        fi
    elif command -v pip &> /dev/null; then
        echo "pipì„ ì‚¬ìš©í•˜ì—¬ uv ì„¤ì¹˜ ì‹œë„ ì¤‘..."
        if pip install uv 2>/dev/null; then
            install_success=true
        fi
    fi
    
    # ë°©ë²• 2: curl ì‚¬ìš©
    if [ "$install_success" = false ]; then
        echo "curlì„ ì‚¬ìš©í•˜ì—¬ uv ì„¤ì¹˜ ì‹œë„ ì¤‘..."
        if curl -LsSf https://astral.sh/uv/install.sh | sh 2>/dev/null; then
            export PATH="$HOME/.local/bin:$PATH"
            install_success=true
        fi
    fi
    
    # ë°©ë²• 3: macOS Homebrew
    if [ "$install_success" = false ] && [[ "$OSTYPE" == "darwin"* ]] && command -v brew &> /dev/null; then
        echo "Homebrewë¥¼ ì‚¬ìš©í•˜ì—¬ uv ì„¤ì¹˜ ì‹œë„ ì¤‘..."
        if brew install uv 2>/dev/null; then
            install_success=true
        fi
    fi
    
    if [ "$install_success" = false ]; then
        handle_error "uv ì„¤ì¹˜ ì‹¤íŒ¨. https://docs.astral.sh/uv/getting-started/installation/ ì°¸ì¡°"
    fi
    
    echo -e "${GREEN}âœ… uv ì„¤ì¹˜ ì™„ë£Œ${NC}"
fi

echo
echo -e "${YELLOW}[2/6] Python 3.11 ì„¤ì¹˜ ì¤‘...${NC}"
uv python install 3.11 || handle_error "Python 3.11 ì„¤ì¹˜ ì‹¤íŒ¨"
echo -e "${GREEN}âœ… Python 3.11 ì„¤ì¹˜ ì™„ë£Œ${NC}"

echo
echo -e "${YELLOW}[3/6] ê°€ìƒí™˜ê²½ ìƒì„± ë° ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘...${NC}"
uv sync || handle_error "ê°€ìƒí™˜ê²½ ìƒì„± ë˜ëŠ” ì˜ì¡´ì„± ì„¤ì¹˜ ì‹¤íŒ¨"
echo -e "${GREEN}âœ… ê°€ìƒí™˜ê²½ ë° ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ${NC}"

echo
echo -e "${YELLOW}[4/6] ì„¤ì¹˜ í™•ì¸ ì¤‘...${NC}"
.venv/bin/python --version || handle_error "Python ë²„ì „ í™•ì¸ ì‹¤íŒ¨"
.venv/bin/python -c "import matplotlib, numpy, networkx; print('âœ… ëª¨ë“  íŒ¨í‚¤ì§€ ì •ìƒ ì„¤ì¹˜ë¨')" || handle_error "íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸ ì‹¤íŒ¨"

echo
echo -e "${YELLOW}[5/6] ì„¤ì¹˜ ì™„ë£Œ!${NC}"
echo -e "${BLUE}==========================================${NC}"
echo
echo -e "${GREEN}ğŸ‰ ì„¤ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!${NC}"
echo
echo -e "${BLUE}ğŸ“‹ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ë°©ë²•:${NC}"
echo -e "   ë°©ë²• 1: ${YELLOW}.venv/bin/python main.py${NC}"
echo -e "   ë°©ë²• 2: ${YELLOW}source .venv/bin/activate${NC} í›„ ${YELLOW}python main.py${NC}"
echo
echo -e "${BLUE}ğŸ“ ì¶”ê°€ ëª…ë ¹ì–´:${NC}"
echo -e "   ê°€ìƒí™˜ê²½ í™œì„±í™”: ${YELLOW}source .venv/bin/activate${NC}"
echo -e "   ê°€ìƒí™˜ê²½ ë¹„í™œì„±í™”: ${YELLOW}deactivate${NC}"
echo
echo -e "${BLUE}==========================================${NC}"
echo 